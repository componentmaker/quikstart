apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-controller-config
  namespace: kafka
  labels:
    app: kafka
    component: controller
data:
  server.properties: |
    #
    # ================= KRAFT CONTROLLER CONFIGURATION =================
    #

    # --- Role and Node ID ---
    process.roles=controller
    node.id=CONTROLLER_ID_PLACEHOLDER

    # --- KRaft Quorum ---
    controller.quorum.voters=0@kafka-controller-0.kafka-controller-headless.kafka.svc.cluster.local:9093,1@kafka-controller-1.kafka-controller-headless.kafka.svc.cluster.local:9093,2@kafka-controller-2.kafka-controller-headless.kafka.svc.cluster.local:9093

    # --- Listeners ---
    listeners=CONTROLLER://:9093
    controller.listener.names=CONTROLLER
    listener.security.protocol.map=CONTROLLER:SSL

    # --- Security: SSL/TLS for the CONTROLLER listener ---
    listener.name.controller.ssl.keystore.location=/etc/kafka/secrets/controller.keystore.jks
    listener.name.controller.ssl.keystore.password=SSL_PASSWORD_PLACEHOLDER
    listener.name.controller.ssl.truststore.location=/etc/kafka/secrets/controller.truststore.jks
    listener.name.controller.ssl.truststore.password=SSL_PASSWORD_PLACEHOLDER
    listener.name.controller.ssl.client.auth=required

    # --- Security: Authorization ---
    authorizer.class.name=org.apache.kafka.metadata.authorizer.StandardAuthorizer

    # --- Security: Super Users and Principals ---
    super.users=User:kafka-controller;User:kafka-broker;User:kafka-client
    ssl.principal.mapping.rules=RULE:^CN=(.*?)(,.*)?$/$1/

    # --- Log Directories ---
    log.dirs=/kafka/controller-logs
